---
title: Robo Master 2019 赛后总结
tags: [RM]
date: 2018-11-20 00:00:00
category: [日记]
---
### 碎碎念
去佛山之前在赶课程论文的deadline，返校之后又马上开始赶组会报告的deadline，疯狂的第十三周终于结束了，而没有出线也宣告了战队又一年的努力再一次止步。  
一个人要花多久来找到自己喜欢做的事情呢，对于我来说，不断的尝试和积累的沉没成本已经让我意识到，日方长这样的词再也说不出口了。尤其是面对战队这些从小开始写代码，大一甚至更早就打比赛的孩子们，我很清楚我只有这忙乱的研一一年的时间去做这件事了，D多亏导师和战队的理解，我非常狼狈也非常幸运地坚持下来了。  
Timeline部分可能非常私人、情绪化和冗长，可以直接跳过此部分。

### Timeline：
- #### 备战
在进入视觉组之前没有写过cpp，所以从做笔试题开始学习cpp，政治课的时间也正好拿来看c++ primer。读书是我个人比看视频更推荐的学习编程语言的方式，特别是经典的书比如c++ primer，非常详尽地介绍了所有初学者可能注意不到的东西，如果看一些快速入门的东西，可能会漏掉很多重要的细节。这本书在图书馆没有最新版，旧版藏量也很少，先下手为强。学过其他编程语言的话，cpp的入门会很容易，但cpp的深度众所周知，仅对于视觉组的代码而言，最重要的就是理解和熟悉cpp里类的使用，别的可以慢慢学习。整个项目类封装得比较完全，不熟悉类会举步维艰。  
之后搭环境和学习opencv。对于搭环境来说有两个选择，一个是虚拟机，另一个是双系统。我的笔记本比较垃圾，所以用虚拟机非常吃力，同时win10 1903的五月更新里的沙盒会和WMware有冲突，而VirtualBox虽然免费，但确实和WM有差距，所以虚拟机已经不是一个推荐的选择了。对于笔记本来说，装双系统在保修期内也不是一个推荐的选项，我的笔记本已经又老又旧了，所以折腾也不心疼。这里要注意的就是备份好所有数据之后再行动，切记。  
关于opencv，图书馆的书就更少了，我直到寒假前才找到混在各种PS、AE教程中的一本opencv书，而且是讲opencv2的。到比赛结束还这本书的时候才在还书机器旁边看到一本opencv3的书（笑）。不过学习opencv的过程比较容易，看了一个口音超重的视频之后，听了组长的几节课之后，基本语法和常用函数就可以掌握了。这个时候就会意识到，opencv还是一个工具，实际问题的解决其实还是靠基本的算法和一些奇思妙想的。  
基础没问题之后，读开源代码的过程十分痛苦，大疆的还好，只是长。有一些更乱的开源代码读起来会非常费劲，不过了解这些队伍怎么实现基本的识别过程还是十分重要的。一个经验是，由于整个项目比较大，且封装得很好，所以不适合直接从main函数读起，先读几个主要类更合适一些。  
对于今年的大风车，视觉组成员有挺多想法的，各自都写过自己的方案。没记错的话我的方案是颜色threshold -> 边界提取 getStructuringElement -> 形态变换 morphologyEx -> 矩形框出 findContours -> 顺序逻辑。代码debug没有完成，逻辑部分有一些伪代码。这部分最终版的代码是组长写的，虽然没有实用。  
在这之后，我个人做的就比较少了，唯一一个commit就是解决了一下小陀螺的问题。在分析了小陀螺形态的车的识别数据之后，发现在利用几个周期的数据求均值即可得出较为准确的yaw轴数据，因此写了一个固定帧数求均值的简单攻击小陀螺模式。  

- #### 现场
真正到达佛山的现场场地之后，才发现好多非常重要的问题待解决。我非常想把哨兵（也就是我们失败的直接原因）的整个故事记录下来，以警示以后的队员们，不要重蹈覆辙。  
在调试场地，最先发现的问题是超声波没有对准柱子，哨兵到达一端不会返回，拆开内部发现小电脑的位置影响了超声波模块，所以两边的超声波模块没对准，想当然的就装了，没有考虑到两侧是柱子而不是平面的问题。然后马上把超声波改了位置，放在了哨兵底面的下面。  
第二天是热身赛，检录的时候出现了预检录没有遇到的问题，机械设计错误认为了基准面，纵向超尺寸几个厘米，无法通过检录，我们说情后得以参加热身赛。结果发现哨兵撞到一侧再也不动了。不过我们很轻松拿下了对手华机战队，在接下来的调试时间我发现改了位置的超声波模块和竖直平面并不平行，所以这个模块收不到返回来的信号，因此测距远远小于真实值。而另一侧的超声波模块有遮挡，因此测距认为已经到头。哨兵就一致卡在轨道的一侧尽头。  
晚上很多人都来帮我们想办法，我们最终拆了炮管下侧的摄像头，又拆了摄像头框架把摄像头反装，再把框架装在了炮管上侧，同时在炮管后面做了机械限位。整个过程真的是非常复杂，多亏战队好多学弟的帮忙才完成，虽然他们并不负责哨兵。之后我们又调整了超声波模块，终于解决了这个模块的问题。之后电控又修改了他的巡逻模式，改成一致以较大速度逃跑，这也为第二天的翻车埋下了伏笔。  
前一晚熬得很晚，第二天比赛要求很早就开始检录，检录和等待整个过程非常漫长，现在想起来都很紧张。当完成了诸多的检录程序，终于站在比赛现场待场的时候，可能是备赛开始到比赛结束过程中最激动的时刻了，终于来临了。接下来的事情非常惨痛，我们的哨兵运动速度太快，机械重心有偏移，在转一个弯的时候后面的细轴无法固定稳定，导致此轴水平位移，整个哨兵近乎掉落，只剩主动轮吊着。此时我们紧急叫了一分钟的技术暂停，将细的从动轴恢复原样，但当我们离场的时候，哨兵重现了刚刚的故障，裁判要判哨兵离场，我和电控搭档又做了一些尝试，由于有断电但没有reset主控板，哨兵在手动模式竟然还在动，裁判再次发出三级警告，我们只好带哨兵离场。同时，这场比赛我们的遥控器也出了问题，导致一辆步兵无法控制，工程车也基本没有发挥作用，这场比赛理所当然输掉了，而且失去了一千五百左右的基地血量，我们陷入了极大的被动。  
接下来的一场比赛我们把哨兵停在了轨道上，对方没有任何打哨兵的能力，我们毫无悬念的拿下了这场比赛，但没有消耗到对方的基地血量。这个时候才有人发现，在平分的情况下，比赛规则算的是净胜血量，也就是我们与刚刚比赛的对手虽然打平，但基地血量相差三千。这真的是晴天霹雳，更让人无话可说的是下午小组里另一个队伍非常丑陋非常无语地输掉了两场比赛，甚至一度他们领先且有很多可以选的策略，但他们还是连输两场送给我们第一个对手非常好的分数。至此，我们第二天的比赛不仅必须拿下两局，并且需要追回三千点的基地净胜血量，非常难的一个目标。  
为了第二天的比赛我们还是调试了很久，队长重写了电控代码，我们给云台加了机械限位，调了PID和视觉。第二天毕竟是背水一战了。  
第二天的检录其实也有问题，限位的铜柱磨断了一根线，还好即使定位了问题并做了修复，至此，哨兵所担任的唯一任务就是在场上存活不让基地失去装甲。哨兵确实做到了，说来可笑，做到的只是没有被罚下稳定在场。而第一场我们没有能够成功击杀对方哨兵，没有杀伤到对方的基地，这意味着我们第二场比赛就算打爆基地，也无法刷够三千的净胜血量分了。当时站在观赛区做不了任何事的感觉非常难受，主持人宣布我们赢下了第一局，我们确实打得也很不错，但那种一切都无济于事了的感觉真的太难受了，眼泪在眼眶中徘徊，整个人都在颤抖，我们能做的只有等待注定失败的结局了。  
第二场比赛打得异常精彩，虽然对方一直冲撞犯规，但操作手完美的策略让我们从头到尾都压制着对方，消灭地方车，打死哨兵，攻击基地，一切都颇为戏剧性地完美。我们以完胜的姿态拿下了这场比赛。  
虽然后面我找裁判投诉对方哨兵的明显违规的行为让我暂时从悲伤转为愤怒，与边裁争执了很久。整个裁决的过程可谓是极其不专业而不公平，我们毫无办法的接受了淘汰的命运。到这个时候，我的心情已经逐渐平静，所有的问题，终究都是因为赛前准备不足。而所有的侥幸心理和想当然，都会让我们在关键时刻付出代价，决定胜负的代价。

- #### 赛后
其实和战队一起生活一起比赛的这几天真的非常开心，我们熬了很多夜，喝了很多奶茶，聊了很多事情，解决了无数的bug，这些并肩战斗的日子真正让我们成为一个好的团队。感谢各位的帮助和包容。

### 总结
* 一个铁律就是所有不充分的准备和想当然的设计都会让我们付出代价，这些细节可能会毁了一切。
* 一些教训：
  * 调车时间太短，无法测试到足够的本应该在赛前解决的问题。同时，一切没有经过测试的改动都应该视为不稳定的，不应该在重要场次时应用。
  * 一些策略的问题：一个栗子，哨兵非常重要，需要一个成熟的团队完成这个项目；另一个栗子，哨兵不必太激进，稳定是最重要的，否则得不偿失；另一个栗子，操作手的战略非常重要，在制定好战略之后，我们第二天的比赛打得真的非常好。
  * 备份余量增加：我们的电池和桨叶的备份余量都略超出了赛前的估计，遥控器也没有可以赛场直接更换的备份，希望以后比赛能够更从容一点。
* 一些经验：
  * 工作模式：我提出了视觉组使用github的工作模式，事实证明非常适合视觉开发，希望各组也有好的工作模式以增加效率。
  * 任务布置：其实比如大风车的识别要求我们各自写一个出来这样的任务非常好，可以锻炼每个人，又可以让大家跟上整个项目的进度，建议以后每个小模块都能有类似的开发方式。
  * 纵向分组：今年每个车分组的模式还是比较成功的，比赛期间都能比较好的完成调整。

回想起来还是好可惜啊，永远的遗憾了，再见RM。